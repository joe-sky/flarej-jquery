FJ.define("widget.Validate",["widget.Tooltip"],function(){var d,c,a=d=c=this.flareJ,b=this.jQuery;this.ValidateJ=this.VAJ=d.ValidateJ=d.VAJ=d.CJ.extend({init:function(e,f){this._super(e,b.extend(true,{fjType:"VAJ",renderTo:"body",regType:"Empty",input:e,inputE:null,hasTxtErrorColor:true,txtBorderWidth:1,isShowTrue:false,isRegOnReadonly:false,valElem:null,regMsg:"不能为空!",regMsgT:null,regExp:null,allowBlank:null,regFn:null,showMsg:true,isInline:false,msgShift:{t:0,l:0},msgDirect:"bottom",isFixPos:false,isFixScroll:false,onlyShiftPos:false,group:null,width:150,height:22,onlyFirstLoad:null,borderWidth:0,showTrueBg:false,posType:"offset",posParam:null,watermark:null,opacity:0.87,layoutDelay:800,autoTurn:false,colorParams:{bgColor:"transparent",watermark:"#9c9c9c",inputColor:"#333",trueColor:"#333",errorColor:"#333",txtErrorColor:"#edca70",txtColor:"#8EB5D4"},evts:{preReg:null,afterReg:null}},f));this.initFn();return this},initFn:function(){this.p.inputE=(typeof this.p.inputE=="string"?b("#"+this.p.inputE):this.p.inputE);this.p.valElem=(this.p.valElem!=null?(typeof this.p.valElem=="string"?b("#"+this.p.valElem):this.p.valElem):null);this.regMsgTmp=this.p.regMsg;this.regMsgTmpT=this.p.regMsgT;this.regFnMsg=null;this._super();this.create();if(this.p.group){if(!VAJ.group[this.p.group]){VAJ.group[this.p.group]=[]}VAJ.group[this.p.group].push(this)}b(window).on("resize",{thiz:this},this.pageResize)},create:function(){this._super();this.divOut.attr("id","VAJ_"+this.objId).addClass("vaj").css({width:"100%",height:"auto"});this.conTable=b("<table class='vaj_table'></table>");this.conTr=b("<tr></tr>");this.conTdL=b("<td class='vaj_td_left'></td>");this.conTdR=b("<td class='vaj_td_right'></td>");this.icon=b('<img class="vaj_iconError" src="'+c.imgPath+'Datagrid/treegrid/s.gif" />');this.msgArea=b("<span></span>");this.divOut.append(this.conTable.append(this.conTr.append(this.conTdL.append(this.icon)).append(this.conTdR.append(this.msgArea))));this.bindInput();return this},bindInput:function(){var e=this;this.p.input.css({borderWidth:this.p.txtBorderWidth,borderColor:this.p.colorParams.txtColor,borderStyle:"solid",color:this.p.colorParams.inputColor});this.setWatermark();switch(this.p.regType){case"Empty":case"Equal":case"Exp":case"Custom":this.p.input.bind("blur",function(f){e.reg()});break;case"MaxLength":this.p.showTrueBg=1;this.p.input.bind("keyup",function(){e.reg()});break}this.ttj=b(this.p.input).TTJ({renderTo:this.p.renderTo,hoverDirect:this.p.msgDirect,shiftLeft:this.p.msgShift.l,shiftTop:this.p.msgShift.t,onlyShiftPos:this.p.onlyShiftPos,radius:0,hoverType:"free",speed:1,showSpeed:200,width:this.p.width,height:this.p.height,isAsync:false,hasShadow:true,loadType:"html",loadSpeed:1,borderWidth:1,onlyFirstLoad:this.p.onlyFirstLoad,isFixScroll:this.p.isFixScroll,posType:this.p.posType,posParam:this.p.posParam,isAutoSetHeight:false,opacity:this.p.opacity,showLoading:false,isRenderHF:false,responsive:this.p.responsive,responsiveParam:this.p.responsiveParam,autoTurn:this.p.autoTurn,colorParams:{borderOut:this.p.colorParams.ttBorderColor,bgColorBody:this.p.colorParams.ttBgColor}});this.ttj.divOut.bind("mouseover",function(){VAJ.zIndex+=1;b(this).css("z-index",VAJ.zIndex)});if(this.p.isFixPos){this.p.renderTo.bind("scroll",function(){c.lazyDo(function(){this.ttj.showAt()},200,"ld_vajScrollP",e)});b(window).bind("resize",function(){if(!e.ttj.divOut.is(":hidden")){c.lazyDo(function(){this.ttj.showAt()},200,"ld_vajScrollP",e)}})}return this},showInfo:function(e,i){var g=this;var h;this.ttj.setVisible(false);if(e&&this.p.showTrueBg){var f=this.p.colorParams.ttBgColorT;if(f){if(d.isIE){this.ttj.bodyIn[0].style.filter="alpha(opacity=100) progid:DXImageTransform.Microsoft.Gradient(GradientType=0, EndColorStr='"+f+"', StartColorStr='"+f+"')"}else{this.ttj.pjBody.css("background-color",f)}}}else{var j=this.p.colorParams.ttBgColor;if(j){if(d.isIE){this.ttj.bodyIn[0].style.filter="alpha(opacity=100) progid:DXImageTransform.Microsoft.Gradient(GradientType=0, EndColorStr='"+j+"', StartColorStr='"+j+"')"}else{this.ttj.pjBody.css("background-color",j)}}}if(e){if(this.p.hasTxtErrorColor){this.p.input.css("border",this.p.txtBorderWidth+"px solid "+this.p.colorParams.txtColor)}if(this.p.isShowTrue){this.divOut.css({color:this.p.colorParams.trueColor});this.icon.swapClassJ("vaj_iconError","vaj_iconTrue");this.msgArea.text(i?i:this.p.regMsgT)}else{return}}else{if(this.p.hasTxtErrorColor){this.p.input.css("border",this.p.txtBorderWidth+"px solid "+this.p.colorParams.txtErrorColor)}this.divOut.css({color:this.p.colorParams.errorColor});this.icon.swapClassJ("vaj_iconTrue","vaj_iconError");this.msgArea.text(i?i:this.p.regMsg)}this.ttj.p.fnHtml=function(){return g.divOut.show()};this.ttj.reload();this.ttj.setVisible(true)},reg:function(h,k){var f=this;if(this.p.input.attr("readonly")&&!this.p.isRegOnReadonly){return true}var e=false,g=f.p.input.val(),j=b.trim(g);if(this.p.watermark&&j===this.p.watermark){j=""}var i=function(){switch(f.p.regType){case"Empty":e=j!="";break;case"Equal":e=j==b.trim(f.p.inputE.val());break;case"Exp":var m=d.RX.test(f.p.regExp,j);if(f.p.allowBlank){e=m||j==""}else{e=m}break;case"Custom":var m=false,l=j;if(f.p.regFn){m=f.p.regFn.call(f,l,h)}if(f.p.allowBlank){e=m||l==""}else{e=m}break;case"MaxLength":if(g.length>f.p.maxLength){f.p.regMsg=f.regMsgTmp.replace(/\{0\}/g,f.p.maxLength);e=0}else{f.p.regMsgT=f.regMsgTmpT.replace(/\{0\}/g,f.p.maxLength-g.length);if(f.p.allowBlank){e=1}else{if(j!=""){e=1}else{f.p.regMsg=f.p.regMsgB;e=0}}}if(e&&f.p.regFn){var l=j,m=f.p.regFn.call(f,l);if(f.p.allowBlank){e=m||l==""}else{e=m}if(!e){f.p.regMsg=f.p.regMsgF}}break}};if(this.p.evts.preReg){if(this.fire("preReg")){e=true}else{i()}}else{i()}if(!k){this.showInfo(e,this.regFnMsg)}this.regFnMsg=null;if(j===""){this.setWatermark()}this.fire("afterReg",{result:e,val:j,sign:h});return e},reset:function(){if(this.p.hasTxtErrorColor){this.p.input.css({borderColor:this.p.colorParams.txtColor})}this.setWatermark(1);this.ttj.setVisible(0)},setWatermark:function(f){if(this.p.watermark!=null){var e=this;if(f){this.p.input.unbind("focus")}this.p.input.css("color",this.p.colorParams.watermark).val(this.p.watermark).one("focus",function(){b(this).css("color",e.p.colorParams.inputColor).val("")})}},pageResize:function(h){var g=h.data.thiz,f=g.ttj;c.lazyDo(function(){if(f.tranState==="show"){f.setVisible(true,null,true)}},g.p.layoutDelay,"ld_vaj_layout",g)},remove:function(){this.ttj.remove();this._super();b(window).off("resize",this.pageResize)}});d.VAJ.zIndex=100;d.VAJ.group={};d.VAJ.clearGroup=function(e){if(VAJ.group[e]){delete VAJ.group[e]}};d.VAJ.reg=function(k,j){var f=VAJ.group[k];if(f&&f.length>0){var e=true;for(var h=0,g=f.length;h<g;h++){if(!f[h].reg(j)){e=false}}return e}else{return false}};d.VAJ.reset=function(h){var e=VAJ.group[h];if(e&&e.length>0){for(var g=0,f=e.length;g<f;g++){e[g].reset()}}};b.fn.extend({ValidateJ:function(e){if(this&&this.length>0){return new d.ValidateJ(this,c.VAJ_commonConfig?b.extend(true,c.clone(c.VAJ_commonConfig),e):e)}},VAJ:function(e){return b(this).ValidateJ(e)}})});