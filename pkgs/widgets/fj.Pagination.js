FJ.define("widget.Pagination",["widget.AutoComplete"],function(){var d,c,a=d=c=this.flareJ,b=this.jQuery;this.PaginationJ=this.PNJ=d.PaginationJ=d.PNJ=d.CJ.extend({init:function(e,f){this._super(e,b.extend(true,{fjType:"PNJ",renderTo:e,width:"auto",height:30,borderWidth:0,dataCount:0,noCount:false,pageSize:10,isSetPageSize:false,pageSizes:[15,30,50],storeName:null,pageCount:0,curPage:0,cpWidth:45,pageInputCache:true,sort:"",dir:"ASC",showOnInit:false,initDelay:300,pageInit:false,initData:{page:null,data:null,count:null,total:null},totalTxt:"条数据",url:null,urlData:{type:"Get"},btnGoName:"确定",hasPages:true,isLocal:false,isAutoPageLocal:false,data:null,showDataCount:true,showPageSize:true,showPageCount:true,showRefresh:true,renderToAcj:"body",colorParams:{bgColor:"transparent"},evts:{onPaging:null,preOnPage:null,finOnPage:null,preRefresh:function(h,g){if(typeof oDgj!="undefined"){oDgj.clearPageCache()}}}},f));this.initFn();return this},initFn:function(){this._super();if(this.p.noCount){this.countC=1;this.pagesC={};this.isComplete=false}if(c.isMobile){this.p.pageInputCache=false}this.create();if(this.p.storeName){var e=c.LocalStorage.getItem({key:"pnj_pagesize_"+this.p.storeName});if(e){this.p.pageSize=e}}if(!this.p.showDataCount){this.pnjDataCount.hide()}if(!this.p.showPageSize){this.pnjPageSize.hide()}if(!this.p.showPageCount){this.pnjPageCount.hide()}if(!this.p.showRefresh){this.pnjRefresh.hide()}if(this.p.showOnInit){this.show()}else{if(this.p.pageInit){this.show(1)}else{this.setVisible(false)}}this.sbnj=this.divOut.ScrollButtonJ({targetElem:this.pnjBody,top:2,hasAnimate:true})},create:function(){this._super();var g=this,h=this.p.hasPages,f=null;this.divOut.addClass("pnj").attr("id","PNJ_"+this.objId).css({height:this.p.height,width:this.p.width});this.pnjBody=f=b('<div class="pnj-body"></div>');if(c.isMobile){f.addClass("fj-mobile")}this.pnjDataCount=b('<div class="pnj_info"></div>');this.pnjDataCountN=b("<span>"+this.p.dataCount+"</span>");this.pnjDataCount.append("共").append(this.pnjDataCountN).append(this.p.totalTxt);this.pnjPageSize=b('<div class="pnj_info"></div>');if(this.p.isSetPageSize){this.pnjPageSizeN=b("<select class='fj-form-elem pnj_pageSize'></select>");for(var e=0;e<this.p.pageSizes.length;e++){this.pnjPageSizeN.append("<option value="+this.p.pageSizes[e]+">"+this.p.pageSizes[e]+"</option>")}this.pnjPageSizeN.val(this.p.pageSize);this.pnjPageSizeN.bind("change",function(){g.p.pageSize=g.pnjPageSizeN.val();if(g.p.storeName){c.LocalStorage.setItem({key:"pnj_pagesize_"+g.p.storeName,value:g.p.pageSize})}if(!g.p.noCount){var i=parseInt(g.p.dataCount%g.p.pageSize>0?g.p.dataCount/g.p.pageSize+1:g.p.dataCount/g.p.pageSize,10);if(g.p.curPage<=i){g.refresh()}else{g.refresh(i)}}else{g.refresh()}})}else{this.pnjPageSizeN=b("<span>"+this.p.pageSize+"</span>")}this.pnjPageSize.append("每页").append(this.pnjPageSizeN).append("条");this.pnjPageCount=b('<div class="pnj_info"></div>');this.pnjPageCountN=b("<span>"+this.p.pageCount+"</span>");this.pnjPageCount.append("共").append(this.pnjPageCountN).append("页");this.pnjFirst=b('<div class="pnj_btn pnj_btn_first" title="首页">首页</div>').bind("click",function(){if(g.pnjFirst.hasClass("pnj_btn_first")){g.onPage(1)}}).addClass("pnj_btn_first_g");this.pnjPrev=b('<div class="pnj_btn pnj_btn_prev" title="上一页"></div>').bind("click",function(){if(g.pnjPrev.hasClass("pnj_btn_prev")){g.onPage(parseFloat(g.p.curPage)-1)}}).addClass("pnj_btn_prev_g");this.pnjNext=b('<div class="pnj_btn pnj_btn_next" title="下一页"></div>').bind("click",function(){if(g.pnjNext.hasClass("pnj_btn_next")){g.onPage(parseFloat(g.p.curPage)+1)}}).addClass("pnj_btn_next_g");this.pnjLast=b('<div class="pnj_btn pnj_btn_last" title="末页">末页</div>').bind("click",function(){if(g.pnjLast.hasClass("pnj_btn_last")){g.onPage(g.p.pageCount)}}).addClass("pnj_btn_last_g");this.pnjRefresh=b('<div class="pnj-btn-refresh" title="刷新"><i class="icon-refresh" ></i></div>').bind("click",function(){g.refresh(g.p.curPage)});this.pnjTxt=b('<div class="pnj_txt"></div>');this.pnjCurPage=b('<input class="fj-form-elem pnj_curPage" type="text" value="'+this.p.curPage+'" />').bind("focus",function(){var i=this;setTimeout(function(){i.select()},50)}).bind("blur",function(){if(g.p.dataCount>0){if(!d.RX.ep.num.test(this.value)){this.value=1}}}).width(this.p.cpWidth);if(this.p.pageInputCache){this.acjCp=this.pnjCurPage.ACJ({renderTo:this.p.renderToAcj,width:this.p.cpWidth,shiftTop:17,maxHeight:150,loadMode:"local",dataLimit:100,itemAlign:"right",autoTurn:true,zIndex:this.p.zIndex,evts:{afterSelect:function(j,i){g.onPage(Number(i.val))}}})}this.pnjGo=b('<button type="button" class="btnj pnj-btn-go">'+this.p.btnGoName+"</button>").bind("click",function(){if(g.p.dataCount>0){var i=parseFloat(g.pnjCurPage.val());if(i<=parseFloat(g.p.pageCount)){g.onPage(i)}else{g.onPage(g.p.pageCount)}}});this.pnjTxt.append('<div class="pnj_txt_div">到</div>').append(this.pnjCurPage).append('<div class="pnj_txt_div">页</div>').append(this.pnjGo);this.divOut.append(f.append(this.pnjFirst).append(this.pnjPrev));if(h){this.pnjPages=b('<div class="pnj_pages"></div>');f.append(this.pnjPages)}else{f.append(this.pnjTxt)}f.append(this.pnjNext).append(this.pnjLast).append(this.pnjPageCount).append(this.pnjDataCount).append(this.pnjPageSize);if(h){f.append(this.pnjTxt)}f.append(this.pnjRefresh);return this},show:function(f){var e=this;this._super();if(!f){setTimeout(function(){e.onPage(1)},this.p.initDelay)}else{var g=this.p.initData;this.fire("beforeInitData",g);this.update(g.page,g.data,g.count,g.total,null,null,1)}return this},onPage:function(n,o){var k=this;this.pnjRefresh.find("i").swapClassJ("icon-refresh","icon-spinner");this.fire("preOnPage");this.p.urlData=b.extend(this.p.urlData,{curPage:n,pageSize:this.p.pageSize,sort:this.p.sort,dir:this.p.dir});var f,h;if(this.p.isLocal){var q=parseInt(this.p.pageSize,10);n=parseInt(n,10);f=this.p.data;h=[];if(f&&f.length>0){for(var j=(n-1)*q,g=j+q;j<g;j++){var m=f[j];if(m){h.push(m)}}}}var e={page:n,data:h,total:(f!=null?f.length:null),ex:o};if(!this.p.isAutoPageLocal){if(this.p.evts.OnPaging){this.fire("OnPaging",e)}else{this.fire("onPaging",e)}}else{if(e.data&&e.data.length>0){this.update(e.page,e.data,e.data.length,e.total)}else{this.update(e.page,[],0,0)}}c.lazyDo(function(){k.sbnj.checkShow()},500)},update:function(t,n,r,u,o,l,f){var q=this;if(!q.p.noCount){q.p.dataCount=u}else{if(!q.pagesC[t]){q.pagesC[t]=1;q.countC+=r;if(r<this.p.pageSize){q.countC-=1;q.isComplete=true}q.p.dataCount=q.countC}}var h=this.pnjDataCountN,e=this.p.dataCount;if(!q.p.noCount){h.text(e)}else{h.text((e>0&&!q.isComplete)?e-1:e)}if(this.p.isSetPageSize){this.pnjPageSizeN.val(this.p.pageSize)}else{this.pnjPageSizeN.text(this.p.pageSize)}this.p.pageCount=parseInt(this.p.dataCount%this.p.pageSize>0?this.p.dataCount/this.p.pageSize+1:this.p.dataCount/this.p.pageSize,10);this.pnjPageCountN.text(this.p.pageCount);var g=false;if(r>0){this.setPageC(t)}else{if(!q.p.noCount){this.setPageC(0)}else{if(t!=1){g=true}else{this.setPageC(0)}}}if(e>0){this.pnjFirst.removeClass("pnj_btn_first_g").addClass("pnj_btn_first");this.pnjPrev.removeClass("pnj_btn_prev_g").addClass("pnj_btn_prev");this.pnjNext.removeClass("pnj_btn_next_g").addClass("pnj_btn_next");this.pnjLast.removeClass("pnj_btn_last_g").addClass("pnj_btn_last");if(this.p.pageCount<=1){this.pnjFirst.removeClass("pnj_btn_first").addClass("pnj_btn_first_g");this.pnjPrev.removeClass("pnj_btn_prev").addClass("pnj_btn_prev_g");this.pnjNext.removeClass("pnj_btn_next").addClass("pnj_btn_next_g");this.pnjLast.removeClass("pnj_btn_last").addClass("pnj_btn_last_g")}else{if(this.p.curPage==1){this.pnjFirst.removeClass("pnj_btn_first").addClass("pnj_btn_first_g");this.pnjPrev.removeClass("pnj_btn_prev").addClass("pnj_btn_prev_g")}else{if(this.p.curPage==this.p.pageCount){this.pnjNext.removeClass("pnj_btn_next").addClass("pnj_btn_next_g");this.pnjLast.removeClass("pnj_btn_last").addClass("pnj_btn_last_g")}}}if(this.p.hasPages){this.pnjPages.empty();if(this.p.pageCount<=10){for(var m=1;m<=this.p.pageCount;m++){(function(i){q.pnjPages.append(b("<div class='"+(m==q.p.curPage?"pnj_pagesNoC":"pnj_pagesNo")+"' title='第"+m+"页'>"+m+"</div>").click(function(){q.onPage(i)}))})(m)}}else{if(this.p.curPage<=4){for(var m=1;m<=this.p.curPage+2;m++){(function(i){q.pnjPages.append(b("<div class='"+(m==q.p.curPage?"pnj_pagesNoC":"pnj_pagesNo")+"' title='第"+m+"页'>"+m+"</div>").click(function(){q.onPage(i)}))})(m)}this.pnjPages.append(b("<div>...</div>").click(function(){q.onPage(parseFloat(q.p.curPage)+1)}));this.pnjPages.append(b("<div class='"+(q.p.pageCount==q.p.curPage?"pnj_pagesNoC":"pnj_pagesNo")+"' title='第"+q.p.pageCount+"页'>"+this.p.pageCount+"</div>").click(function(){q.onPage(q.p.pageCount)}))}else{if(this.p.curPage>4&&this.p.curPage<=this.p.pageCount-3){this.pnjPages.append(b("<div class='"+(1==q.p.curPage?"pnj_pagesNoC":"pnj_pagesNo")+"' title='第1页'>1</div>").click(function(){q.onPage(1)}));this.pnjPages.append(b("<div>...</div>").click(function(){q.onPage(parseFloat(q.p.curPage)-1)}));for(var m=this.p.curPage-2;m<=this.p.curPage+2;m++){(function(i){q.pnjPages.append(b("<div class='"+(m==q.p.curPage?"pnj_pagesNoC":"pnj_pagesNo")+"' title='第"+m+"页'>"+m+"</div>").click(function(){q.onPage(i)}))})(m)}this.pnjPages.append(b("<div>...</div>").click(function(){q.onPage(parseFloat(q.p.curPage)+1)}));this.pnjPages.append(b("<div class='"+(q.p.pageCount==q.p.curPage?"pnj_pagesNoC":"pnj_pagesNo")+"' title='第"+q.p.pageCount+"页'>"+this.p.pageCount+"</div>").click(function(){q.onPage(q.p.pageCount)}))}else{if(this.p.curPage>this.p.pageCount-3){this.pnjPages.append(b("<div class='"+(1==q.p.curPage?"pnj_pagesNoC":"pnj_pagesNo")+"' title='第1页'>1</div>").click(function(){q.onPage(1)}));this.pnjPages.append(b("<div>...</div>").click(function(){q.onPage(parseFloat(q.p.curPage)-1)}));for(var m=this.p.curPage-2;m<=this.p.pageCount;m++){(function(i){q.pnjPages.append(b("<div class='"+(m==q.p.curPage?"pnj_pagesNoC":"pnj_pagesNo")+"' title='第"+m+"页'>"+m+"</div>").click(function(){q.onPage(i)}))})(m)}}}}}}}else{this.pnjFirst.removeClass("pnj_btn_first").addClass("pnj_btn_first_g");this.pnjPrev.removeClass("pnj_btn_prev").addClass("pnj_btn_prev_g");this.pnjNext.removeClass("pnj_btn_next").addClass("pnj_btn_next_g");this.pnjLast.removeClass("pnj_btn_last").addClass("pnj_btn_last_g");if(this.p.hasPages){this.pnjPages.empty()}}if(this.p.pageInputCache&&!g){var p=this.acjCp.p.data,s=false;this.acjCp.isAllLastTime=false;for(var j=0;j<p.length;j++){if(p[j].text==t){s=true;break}}if(!s){p.push({text:t,value:t})}p.sort(function(k,i){return c.Sort.compareNumber(k.text,i.text,true)})}if(!f){this.fire("finOnPage",{data:n,page:t,total:u,dataF:o,params:l,noOpe:g})}this.stopRefresh()},refresh:function(f,g,e){this.fire("preRefresh",{page:f,data:this.p.data,isInit:g,ex:e});if(this.p.pageInputCache){this.acjCp.p.data.length=0}if(this.p.noCount){f=1;this.isComplete=false;this.pagesC={};this.countC=1;this.p.dataCount=0}if(f==null){this.onPage(this.p.curPage,e)}else{this.onPage(f,e)}},clearData:function(e){this.update(e?e:1,[],0,0)},setPageC:function(e){this.p.curPage=e;this.pnjCurPage.val(e)},stopRefresh:function(){this.pnjRefresh.find("i").swapClassJ("icon-spinner","icon-refresh")}});b.fn.extend({PaginationJ:function(e){if(this&&this.length>0){return new d.PaginationJ(this,c.PNJ_commonConfig?b.extend(true,c.clone(c.PNJ_commonConfig),e):e)}},PNJ:function(e){return b(this).PaginationJ(e)}});d.PNJ.imgSrc=d.imgPath+"Pagination/"});