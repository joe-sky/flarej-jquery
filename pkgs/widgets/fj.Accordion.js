FJ.define("widget.Accordion",["widget.Panel"],function(){var d,c,a=d=c=this.flareJ,b=this.jQuery;this.AccordionJ=this.ADJ=d.AccordionJ=d.ADJ=d.CJ.extend({init:function(e,f){this._super(e,b.extend(true,{fjType:"ADJ",renderTo:e,width:200,height:"100%",borderWidth:null,btnHeight:31,itemHeight:40,minConHeight:38,minAreaHeight:null,selectIndex:0,expandOne:true,showLoading:false,itemAlign:"center",itemMarginLeft:0,showHead:true,showFoot:true,hasSound:false,hasSelectColor:true,hasAnimate:c.isMobile?0:1,isAutoSetHeight:true,emptyTxt:"没有数据",items:[],colorParams:{borderOut:null,bgColor:"#fff"},evts:{afterItemPageLoad:null}},f));this.initFn();return this},initFn:function(){var h=this,e=this.p.expandOne,m=this.p.isAutoSetHeight;this._super();this.create();this.show();if(m||!this.p.items.length){var n=this.p.btnHeight*2;if(!this.p.showHead){n-=this.p.btnHeight}if(!this.p.showFoot){n-=this.p.btnHeight}this.contentArea.css("height",m?this.divOut.height()-n:"auto")}if(this.p.minAreaHeight){this.contentArea.css("min-height",this.p.minAreaHeight)}if(!this.p.expandOne){this.contentArea.css("overflow-y","auto");this.hasScroll=true}this.items=[];this.panels=[];if(this.p.items&&this.p.items.length>0){for(var g=0,f=this.p.items.length;g<f;g++){var o=this.p.items[g],k=e?g==h.p.selectIndex:o.expand,j=b('<div class="adj_item'+((this.p.hasSelectColor&&k)?" adj_selectedItem":"")+'"><span style="margin-left:'+this.p.itemMarginLeft+'px">'+o.text+"</span></div>").css({height:this.p.itemHeight,lineHeight:this.p.itemHeight+"px",textAlign:this.p.itemAlign});this.contentArea.append(j);this.items[this.items.length]=j;(function(s,q,r){j.onGestureJ(c.Evt.click,function(){if(!h.isOnChange){h.expandItem(s)}});if(q.html==null){q.html=""}if(q.canSearch){q.html=StringBuilderJ.join(["<div class='adj-auto-complete'>","<div class='adj-search-icon glaj-col-pc1'><i class='icon-search'></i></div>","<div class='adj-search-input glaj-col-pc11'><input type='text' class='fj-form-elem'></div>","</div><div class='adj-search-list'>"+q.html+"</div>"]);q.noBodyScroll=true}var l=q.isAutoSetHeight,i=q.isAutoSetWidth,p=h.contentArea.PJ(b.extend(true,q,{width:"100%",height:r?(l===false?"auto":h.countContentH()):0,divState:r?"max":"min",showOnInit:r?true:false,showHead:false,showFoot:false,bodyPadding:q.bodyPadding,isRenderHF:false,borderWidth:q.borderWidth==null?{t:0,r:0,b:r?1:0,l:0}:q.borderWidth,isInitShow:false,onlyFirstLoad:q.loadOnShow?null:true,showLoading:h.p.showLoading,isAutoSetHeight:l==null?true:l,isAutoSetWidth:i==null?true:i,loadType:(function(){var t;if(q.iframe){t="iframe"}else{if(q.ajax){t="ajax"}else{t="html"}}return t})(),bodyInId:q.id,iframeId:q.iframeId,bodyUrl:q.url,ajaxParams:q.ajaxParams,fnHtml:function(){return q.html},colorParams:{bgColor:"#ffffff"},evts:b.extend(true,{afterBodyLoadTabs:function(u,t){h.fire("afterItemPageLoad",{no:g,panel:this,type:t})},afterBodyLoadI:function(){if(q.canSearch){var t=this.bodyIn;t.css("padding-top",30).addClass("fj-border-box");this.searchInput=t.find("input.fj-form-elem");this.searchList=t.find("div.adj-search-list")}}},q.evts)}));if(!p.p.isAutoSetHeight){p.bodyIn.css("height","auto")}h.panels[h.panels.length]=p})(g,o,k)}if(this.hasScroll){this.panels[this.p.selectIndex].reLayout()}}else{this.clearData()}this.initLayer=true},create:function(){var e=this;this._super();this.adjId="ADJ_"+this.objId;this.divOut.attr("id",this.adjId).addClass("adj").css({width:this.p.width,height:this.p.height});if(this.p.showHead){this.headBtn=b('<div class="adj_headBtn adj_btnNoHover"><div class="adj_headBtnArrow'+(this.p.hasAnimate?" fj-has-animate":"")+'"><i class="icon-chevron-up" ></i></div></div>').hover(function(){b(this).swapClassJ("adj_btnNoHover","adj_btnHover")},function(){b(this).swapClassJ("adj_btnHover","adj_btnNoHover")}).onGestureJ(c.Evt.click,function(){if(e.items.length&&!e.isOnChange){var f=e.p.selectIndex-1;if(f<0){f=0}e.expandItem(f)}})}this.contentArea=b('<div class="adj_contentArea"></div>');if(this.p.showFoot){this.footBtn=b('<div class="adj_footBtn adj_btnNoHover"><div class="adj_footBtnArrow'+(this.p.hasAnimate?" fj-has-animate":"")+'"><i class="icon-chevron-down" ></i></div></div>').hover(function(){b(this).swapClassJ("adj_btnNoHover","adj_btnHover")},function(){b(this).swapClassJ("adj_btnHover","adj_btnNoHover")}).onGestureJ(c.Evt.click,function(){if(e.items.length&&!e.isOnChange){var g=e.p.selectIndex+1,f=e.items.length;if(g>=f){g=f-1}e.expandItem(g)}})}if(this.p.showHead){this.divOut.append(this.headBtn)}this.divOut.append(this.contentArea);if(this.p.showFoot){this.divOut.append(this.footBtn)}return this},expandItem:function(o){var e=this.p.expandOne;if(e&&o==this.p.selectIndex){return}var i=this,q=this.p.items[o],k=this.items[o],m=this.panels[o],h=this.p.hasSelectColor,r=q.expand,f=true;this.isOnChange=true;if(this.p.hasSound){c.lazyDo(function(){c.playSound.play("adj1")})}if(!q.expand){m.show();if(!m.p.isAutoSetHeight){m.divOut.height(0);m.pjBody.show();var g=m.pjBody[0].scrollHeight,j=this.p.minConHeight,l=0;if(j==null||g>=j){l=g}else{l=j;f=false}m.p.height=l}else{m.p.height=this.countContentH()}}m.bodyIn.css("overflow","hidden");if(e){var p=this.panels[this.p.selectIndex];p.bodyIn.css("overflow","hidden");p.maxMin(function(){this.divOut.css("border-width",0);p.bodyIn.css("overflow","auto")})}m.maxMin(function(){if(!r){this.divOut.css("border-bottom-width",1)}else{this.divOut.css("border-width",0)}if(f&&this.p.divState==="max"&&!this.p.isAutoSetHeight){this.divOut.css("height","auto")}m.bodyIn.css("overflow","auto");i.isOnChange=false;i.fire("afterExpandItem",{no:o,panel:m})});if(e){var n=this.items[this.p.selectIndex];if(h){n.removeClass("adj_selectedItem")}n.expand=false}if(!q.expand){if(h){k.addClass("adj_selectedItem")}if(!e){q.expand=true}}else{if(h){k.removeClass("adj_selectedItem")}q.expand=false}this.p.selectIndex=o},clearData:function(){this.p.items.length=0;if(this.p.showFoot&&!c.isIE7){this.footBtn.css("margin-top",-1)}this.contentArea.html(b('<div style="width:100%;height:100%;position:absolute;text-align:center;"></div>').append(b('<div style="width:100%;height:100%;" class="cj_divCvFd1"></div>').append(b('<div style="text-align:center;" class="cj_divCvFd2"></div>').append(b('<div class="cj_divCvFd3 adj_emptyTxt"></div>').append(this.p.emptyTxt)))))},countContentH:function(){var f;if(!this.hasScroll){var e=this.p.items.length,f=this.contentArea.height()-this.p.itemHeight*e-(c.isIE7?e:(1+e));if(f<this.p.minConHeight){f=this.p.minConHeight;this.contentArea.css("overflow-y","auto");this.hasScroll=true}}else{f=this.p.minConHeight}return f}});b.fn.extend({AccordionJ:function(e){if(this&&this.length>0){return new d.AccordionJ(this,c.ADJ_commonConfig?b.extend(true,c.clone(c.ADJ_commonConfig),e):e)}},ADJ:function(e){return b(this).AccordionJ(e)}});d.ADJ.imgSrc=d.imgPath+"Accordion/";if(!c.isMobile){c.playSound.init("adj1",d.mediaPath+"XP_kaishi.wav")}});